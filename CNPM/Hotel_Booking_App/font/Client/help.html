<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trung t√¢m tr·ª£ gi√∫p - HotelBooking</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    
    <style>
        /* --- 1. GLOBAL LAYOUT (Cho ph√©p cu·ªôn trang) --- */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #eef2f6;
            min-height: 100vh; /* ƒê·∫£m b·∫£o trang lu√¥n cao √≠t nh·∫•t b·∫±ng m√†n h√¨nh */
            display: flex;
            flex-direction: column;
            /* ƒê√£ X√ìA overflow: hidden ƒë·ªÉ cho ph√©p cu·ªôn to√†n trang */
        }

        .navbar {
            background-color: #343a40 !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* Ph·∫ßn gi·ªØa: ƒê·∫©y footer xu·ªëng ƒë√°y */
        .main-wrapper {
            flex: 1; 
            display: flex;
            justify-content: center;
            align-items: center; /* CƒÉn gi·ªØa card theo chi·ªÅu d·ªçc n·∫øu trang ng·∫Øn */
            padding: 40px 20px;
        }

        /* --- 2. CARD TRUNG T√ÇM (C√≥ gi·ªõi h·∫°n chi·ªÅu cao) --- */
        .help-container-card {
            background: white;
            width: 100%;
            max-width: 1200px;
            
            /* GI·ªöI H·∫†N CHI·ªÄU CAO ƒê·ªÇ K√çCH HO·∫†T CU·ªòN N·ªòI B·ªò */
            height: 80vh;  /* Chi·∫øm 80% chi·ªÅu cao m√†n h√¨nh */
            min-height: 600px; /* Nh∆∞ng kh√¥ng ƒë∆∞·ª£c th·∫•p qu√° 600px */
            
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Bo g√≥c m∆∞·ª£t m√† */
        }

        .help-card-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
            color: white;
            padding: 25px 40px;
            flex-shrink: 0; /* Header lu√¥n hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-card-body {
            flex: 1; /* Chi·∫øm ph·∫ßn c√≤n l·∫°i c·ªßa card */
            overflow: hidden; /* Quan tr·ªçng: ƒê·ªÉ con c√°i (faq/form) cu·ªôn ƒë∆∞·ª£c b√™n trong */
            padding: 0;
        }

        /* --- 3. V√ôNG CU·ªòN RI√äNG (FAQ & FORM) --- */
        .row-full-height {
            height: 100%;
            margin: 0;
        }

        .faq-scroll-area {
            height: 100%;       /* Full chi·ªÅu cao cha */
            overflow-y: auto;   /* B·∫¨T CU·ªòN D·ªåC RI√äNG CHO C·ªòT N√ÄY */
            padding: 30px;
            padding-right: 15px; 
        }

        .form-static-area {
            height: 100%;
            padding: 30px;
            background-color: #f8f9fa;
            overflow-y: auto;   /* Form c≈©ng cu·ªôn ri√™ng n·∫øu d√†i qu√° */
            border-left: 1px solid #eee;
        }

        /* T√πy ch·ªânh thanh cu·ªôn n·ªôi b·ªô cho ƒë·∫πp */
        .faq-scroll-area::-webkit-scrollbar, 
        .form-static-area::-webkit-scrollbar { width: 6px; }
        .faq-scroll-area::-webkit-scrollbar-track,
        .form-static-area::-webkit-scrollbar-track { background: transparent; }
        .faq-scroll-area::-webkit-scrollbar-thumb,
        .form-static-area::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        .faq-scroll-area::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        /* Accordion Style */
        .accordion-button:not(.collapsed) { background-color: #f0f7ff; color: #0d6efd; box-shadow: none; }
        .accordion-item { border: 1px solid #e9ecef; margin-bottom: 15px; border-radius: 12px !important; overflow: hidden; }
        .section-title { font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: #6c757d; margin-bottom: 25px; display: block; }

        /* --- 4. FOOTER (ƒê·∫©y xu·ªëng d∆∞·ªõi c√πng) --- */
        .main-footer {
            background-color: #f2f2f2;
            color: #333;
            padding-top: 60px;
            padding-bottom: 40px;
            font-size: 0.95rem;
            margin-top: auto; /* K·ªπ thu·∫≠t ƒë·∫©y footer xu·ªëng ƒë√°y trong Flexbox column */
        }
        .footer-heading { font-weight: 700; text-transform: uppercase; margin-bottom: 20px; font-size: 1rem; color: #212529; }
        .footer-links { list-style: none; padding: 0; }
        .footer-links li { margin-bottom: 12px; }
        .footer-links a { color: #555; text-decoration: none; transition: color 0.2s; }
        .footer-links a:hover { color: #0d6efd; padding-left: 5px; }
        .company-info p { margin-bottom: 8px; color: #666; font-size: 0.9rem; }
        .logo-icon { font-size: 3rem; color: #5a67d8; margin-bottom: 20px; display: inline-block; }

        /* Responsive: Mobile th√¨ b·ªè cu·ªôn ri√™ng, cho cu·ªôn chung c·∫£ trang */
        @media (max-width: 992px) {
            .help-container-card { height: auto; min-height: 0; }
            .faq-scroll-area, .form-static-area { height: auto; overflow: visible; }
            .form-static-area { border-left: none; border-top: 1px solid #eee; }
        }

        /* Chat Widget */
        .chat-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: linear-gradient(to right, #0d6efd, #0b5ed7); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; box-shadow: 0 4px 20px rgba(13, 110, 253, 0.4); cursor: pointer; z-index: 1050; transition: transform 0.2s; }
        .chat-btn:hover { transform: scale(1.1); }
        .chat-window { position: fixed; bottom: 100px; right: 30px; width: 360px; height: 500px; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 1050; display: none; flex-direction: column; overflow: hidden; animation: slideUp 0.3s ease; border: 1px solid #f0f0f0; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .chat-header { background: #0d6efd; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f8f9fa; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 80%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; }
        .message.bot { background: white; align-self: flex-start; border-bottom-left-radius: 2px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .message.user { background: #0d6efd; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-footer { padding: 10px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .typing-indicator { font-size: 0.75rem; color: #888; font-style: italic; margin-left: 15px; display: none; margin-bottom: 5px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top py-3">
        <div class="container">
            <a class="navbar-brand fw-bold fs-4" href="#" id="brand-link">
                <i class="fa-solid fa-hotel me-2"></i>HotelBooking
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-auto d-flex align-items-center" id="nav-content">
                    </div>
            </div>
        </div>
    </nav>

    <div class="main-wrapper">
        <div class="help-container-card">
            
            <div class="help-card-header">
                <div>
                    <h4 class="mb-0 fw-bold"><i class="fa-solid fa-life-ring me-2"></i>Trung t√¢m tr·ª£ gi√∫p</h4>
                    <small class="opacity-75">Ch√∫ng t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</small>
                </div>
                <button class="btn btn-light btn-sm text-primary fw-bold rounded-pill shadow-sm" onclick="goBack()">
                    <i class="fa-solid fa-arrow-left me-1"></i> Quay l·∫°i
                </button>
            </div>

            <div class="help-card-body">
                <div class="row row-full-height g-0">
                    
                    <div class="col-lg-7 h-100">
                        <div class="faq-scroll-area">
                            <span class="section-title text-primary"><i class="fa-solid fa-book-open me-2"></i>C√¢u h·ªèi th∆∞·ªùng g·∫∑p</span>
                            <div class="accordion accordion-flush" id="faqAccordion">
                                <div class="text-center py-5 text-muted">
                                    <div class="spinner-border spinner-border-sm text-primary mb-2" role="status"></div>
                                    <br>ƒêang t·∫£i d·ªØ li·ªáu...
                                </div>
                            </div>
                            <div class="mt-5 text-center text-muted small opacity-50">
                                <i class="fa-solid fa-ellipsis"></i><br>H·∫øt danh s√°ch
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-5 h-100">
                        <div class="form-static-area">
                            <span class="section-title text-success"><i class="fa-solid fa-envelope me-2"></i>Li√™n h·ªá Admin</span>
                            
                            <div class="bg-white p-4 rounded-4 shadow-sm border">
                                <form id="contactForm">
                                    <div class="mb-3" id="email-field-container" style="display: block;">
                                        <label class="form-label fw-bold small text-secondary">Email c·ªßa b·∫°n (*)</label>
                                        <input type="email" id="contact-email" class="form-control" placeholder="Nh·∫≠p email ƒë·ªÉ nh·∫≠n ph·∫£n h·ªìi">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold small text-secondary">Ti√™u ƒë·ªÅ</label>
                                        <input type="text" id="subject" class="form-control" placeholder="V·∫•n ƒë·ªÅ c·∫ßn h·ªó tr·ª£..." required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold small text-secondary">N·ªôi dung chi ti·∫øt</label>
                                        <textarea id="message" class="form-control" rows="5" placeholder="M√¥ t·∫£ chi ti·∫øt..." required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-success w-100 fw-bold py-2">
                                        <i class="fa-solid fa-paper-plane me-2"></i>G·ª≠i Y√™u C·∫ßu
                                    </button>
                                </form>
                                <div class="mt-3 text-center">
                                    <small class="text-muted" style="font-size: 0.8rem;">
                                        <i class="fa-solid fa-clock me-1"></i>Th·ªùi gian ph·∫£n h·ªìi trung b√¨nh: 24h
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="chat-btn" onclick="toggleChat()"><i class="fa-solid fa-comments"></i></div>
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div><i class="fa-solid fa-robot me-2"></i>Tr·ª£ l√Ω AI Booking</div>
            <button type="button" class="btn-close btn-close-white" onclick="toggleChat()"></button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="message bot">Xin ch√†o! üëã<br>M√¨nh l√† tr·ª£ l√Ω ·∫£o AI. B·∫°n c·∫ßn gi√∫p g√¨ kh√¥ng?</div>
        </div>
        <div class="typing-indicator" id="typingIndicator"><span><i class="fa-solid fa-circle fa-bounce" style="font-size: 6px;"></i> AI ƒëang so·∫°n tin...</span></div>
        <div class="chat-footer">
            <input type="text" id="userInput" class="form-control border-0 bg-light" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeypress="handleEnter(event)">
            <button class="btn btn-primary rounded-circle" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <footer class="main-footer mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6 mb-4 company-info">
                    <div class="text-center text-md-start">
                        <i class="fa-solid fa-hotel me-2"></i>
                    </div>
                    <h5 class="fw-bold mb-3">C√¥ng ty TNHH Du l·ªãch v√† D·ªãch v·ª• HotelBooking</h5>
                    <p>S·ªë nh√† 25, ng√µ 276, ƒë∆∞·ªùng Minh Khai, X√£ An Kh√°nh, TP. H√† N·ªôi</p>
                    <p>M√£ s·ªë doanh nghi·ªáp: 0110376372 do S·ªü K·∫ø ho·∫°ch v√† ƒê·∫ßu t∆∞ Th√†nh ph·ªë H√† N·ªôi c·∫•p ng√†y 05/06/2023</p>
                    <p class="mt-3"><i class="fa-solid fa-phone me-2 text-primary"></i> 0392203920</p>
                    <p><i class="fa-solid fa-envelope me-2 text-primary"></i> contact@hotelbooking.vn</p>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <h6 class="footer-heading">GI·ªöI THI·ªÜU</h6>
                    <ul class="footer-links">
                        <li><a href="/BLOG/about.html">V·ªÅ ch√∫ng t√¥i</a></li>
                        <li><a href="/BLOG/terms.html">ƒêi·ªÅu kho·∫£n v√† ƒëi·ªÅu ki·ªán</a></li>
                        <li><a href="/BLOG/privacy.html">Ch√≠nh s√°ch ri√™ng t∆∞</a></li>
                        <li><a href="/BLOG/guide.html">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</a></li>
                        <li><a href="/BLOG/payment.html">H√¨nh th·ª©c thanh to√°n</a></li>
                    </ul>
                </div>

                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="footer-heading">ƒêI·ªÇM ƒê·∫æN</h6>
                    <ul class="footer-links">
                        <li><a href="/BLOG/hanoi.html">H√† N·ªôi</a></li>
                        <li><a href="/BLOG/thanhhoa.html">Thanh H√≥a</a></li>
                        <li><a href="/BLOG/tphcm.html">Th√†nh ph·ªë H·ªì Ch√≠ Minh</a></li>
                        <li><a href="/BLOG/danang.html">ƒê√† N·∫µng</a></li>
                        <li><a href="/BLOG/phuquoc.html">Ph√∫ Qu·ªëc</a></li>
                        <li><a href="/BLOG/vungtau.html">V≈©ng T√†u</a></li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <h6 class="footer-heading">C√ÇU H·ªéI TH∆Ø·ªúNG G·∫∂P</h6>
                    <ul class="footer-links">
                        <li><a href="/BLOG/blog.html">Blog du l·ªãch</a></li>
                        <li><a href="/BLOG/terms.html">Quy ƒë·ªãnh chung v√† l∆∞u √Ω</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center pt-4 mt-4 border-top border-secondary-subtle">
                <p class="mb-0 small text-muted">&copy; 2024 HotelBooking. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = "https://api.ducmanhsuncloud.click";
        let isLoggedIn = false;

        document.addEventListener("DOMContentLoaded", () => {
            const token = localStorage.getItem("access_token");
            const navContent = document.getElementById("nav-content");
            const brandLink = document.getElementById("brand-link");

            if (token) {
                brandLink.href = "home1.html"; 
                navContent.innerHTML = `
                    <a href="/BLOG/blog.html" class="btn btn-outline-light me-2 rounded-pill px-3">BLOG</a>
                    <a href="help.html" class="btn btn-outline-light me-2 rounded-pill px-3 active">
                        <i class="fa-solid fa-circle-question me-1"></i> Tr·ª£ gi√∫p
                    </a>
                    <a href="user.html" class="btn btn-outline-light me-2 rounded-pill px-3">
                        <i class="fa-solid fa-user me-1"></i> C√° nh√¢n
                    </a>
                    <button onclick="logout()" class="btn btn-danger rounded-pill px-3">
                        <i class="fa-solid fa-right-from-bracket me-1"></i> ƒêƒÉng Xu·∫•t
                    </button>
                `;
                document.getElementById("contact-email").value = localStorage.getItem("emailuser");
            } else {
                brandLink.href = "../home.html"; 
                navContent.innerHTML = `
                    <a href="/BLOG/blog.html" class="btn btn-outline-light me-2 rounded-pill px-3">BLOG</a>
                    <a href="/Client/help.html" class="btn btn-outline-light me-2 rounded-pill px-3 active">
                        <i class="fa-solid fa-circle-question me-1"></i> Tr·ª£ gi√∫p
                    </a>
                    <a href="../register.html" class="btn btn-outline-light me-2 rounded-pill px-3">ƒêƒÉng k√Ω</a>
                    <a href="../login.html" class="btn btn-outline-light me-2 rounded-pill px-3">ƒêƒÉng nh·∫≠p</a>
                `;
            }
            loadFAQs();
        });
        async function logout() {
            const token = localStorage.getItem("access_token");
            if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?")) return;

            try {
                await fetch("https://api.ducmanhsuncloud.click/logout", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify({ action: "Logout" })
                });
            } catch (err) {
                console.error("L·ªói khi logout:", err);
            } finally {
                localStorage.removeItem("access_token");
                localStorage.removeItem("customer_id");
                localStorage.removeItem("username");
                localStorage.removeItem("fullnameuser");
                localStorage.removeItem("emailuser");    
                window.location.href = "../home.html"; 
            }
        }
        function goBack() {
            if (isLoggedIn) window.history.back();
            else window.location.href = "../home.html";
        }
        document.getElementById("contactForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            
            const subject = document.getElementById("subject").value;
            const message = document.getElementById("message").value;
            let email = document.getElementById("contact-email").value;

            if (!email) { alert("Vui l√≤ng nh·∫≠p email c·ªßa b·∫°n."); return; }
            
            const btn = this.querySelector("button[type=submit]");
            const originalText = btn.innerHTML;
            btn.disabled = true; 
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ƒêang g·ª≠i...';

            try {
                const token = localStorage.getItem("access_token");
                let headers = { "Content-Type": "application/json" };
                if (token) headers["Authorization"] = `Bearer ${token}`;

                const res = await fetch(`${API_BASE_URL}/help/contact_admin`, {
                    method: "POST",
                    headers: headers,
                    body: JSON.stringify({ 
                        subject: subject, 
                        message: message,
                        email: email
                    })
                });

                const data = await res.json();
                if (res.ok) { 
                    alert(data.message || "G·ª≠i th√†nh c√¥ng!"); 
                    this.reset(); 
                    if(!isLoggedIn) document.getElementById("email-field-container").style.display = "block";
                } else { 
                    alert(data.msg || "G·ª≠i th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i."); 
                }
            } catch (error) { 
                alert("L·ªói k·∫øt n·ªëi."); 
            } finally { 
                btn.disabled = false; 
                btn.innerHTML = originalText; 
            }
        });
        async function loadFAQs() {
            try {
                const res = await fetch(`${API_BASE_URL}/help`);
                if (!res.ok) throw new Error("L·ªói t·∫£i");
                const helps = await res.json();
                
                const accordion = document.getElementById("faqAccordion");
                accordion.innerHTML = "";
                if (!helps.length) { accordion.innerHTML = "<div class='text-center py-4 text-muted'>Ch∆∞a c√≥ c√¢u h·ªèi n√†o.</div>"; return; }

                helps.forEach((item, index) => {
                    accordion.innerHTML += `
                        <div class="accordion-item shadow-sm">
                            <h2 class="accordion-header" id="heading${index}">
                                <button class="accordion-button ${index !== 0 ? 'collapsed' : ''} fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}">
                                    ${item.question}
                                </button>
                            </h2>
                            <div id="collapse${index}" class="accordion-collapse collapse ${index === 0 ? 'show' : ''}" data-bs-parent="#faqAccordion">
                                <div class="accordion-body text-secondary bg-white">${item.answer}</div>
                            </div>
                        </div>`;
                });
            } catch (error) {
                document.getElementById("faqAccordion").innerHTML = "<div class='text-center text-muted'>Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¢u h·ªèi.</div>";
            }
        }
        function toggleChat() {
            const w = document.getElementById("chatWindow");
            w.style.display = (w.style.display === "flex") ? "none" : "flex";
            if(w.style.display==="flex") document.getElementById("userInput").focus();
        }
        function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }
        function appendMessage(text, sender) {
            const b = document.getElementById("chatBody");
            const d = document.createElement("div");
            d.className = `message ${sender}`;
            d.innerHTML = text.replace(/\n/g, "<br>");
            b.appendChild(d); b.scrollTop = b.scrollHeight;
        }
        async function sendMessage() {
            const input = document.getElementById("userInput");
            const text = input.value.trim();
            if (!text) return;
            appendMessage(text, 'user');
            input.value = "";
            document.getElementById("typingIndicator").style.display = "block";

            try {
                const token = localStorage.getItem("access_token");
                let headers = { "Content-Type": "application/json" };
                if (token) headers["Authorization"] = `Bearer ${token}`;

                const res = await fetch(`${API_BASE_URL}/help/chat`, {
                    method: "POST",
                    headers: headers,
                    body: JSON.stringify({ message: text })
                });
                let data = {};
                try {
                    data = await res.json();
                } catch (err) {
                    console.warn("Server kh√¥ng tr·∫£ v·ªÅ JSON h·ª£p l·ªá");
                }
                document.getElementById("typingIndicator").style.display = "none";
                if (res.ok) {
                    appendMessage(data.reply, 'bot');
                } else {
                    if (res.status === 429) {
                        appendMessage("‚ö†Ô∏è H·ªá th·ªëng AI ƒëang qu√° t·∫£i (v∆∞·ª£t gi·ªõi h·∫°n). Vui l√≤ng t√¨m ki·∫øm c√¢u tr·∫£ l·ªùi t·ª´ ph√≠a Admin ho·∫∑c th·ª≠ l·∫°i sau.", 'bot');
                    } 
                    else if (res.status === 401 || res.status === 403) {
                        appendMessage("Phi√™n ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.", 'bot');
                    } 
                    else if (res.status === 500) {
                        appendMessage("M√°y ch·ªß ƒëang g·∫∑p s·ª± c·ªë. Vui l√≤ng th·ª≠ l·∫°i sau.", 'bot');
                    } 
                    else {
                        const msg = data.reply || data.message || "ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh.";
                        appendMessage(msg, 'bot');
                    }
                }

            } catch (e) {
                console.error(e);
                document.getElementById("typingIndicator").style.display = "none";
                appendMessage("Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng ki·ªÉm tra m·∫°ng.", 'bot');
            }
        }
    </script>
</body>
</html>