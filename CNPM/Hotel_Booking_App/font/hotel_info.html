<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt kh√°ch s·∫°n</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .hotel-container { margin-top: 30px; }
        .room-card { margin-top: 20px; }
        .room-img { width: 100%; height: 200px; object-fit: cover; }
        .room-info { padding: 15px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="home.html">HotelBooking</a>
        </div>
    </nav>

    <div class="container hotel-container">
        <button class="btn btn-secondary mb-3" onclick="goBack()">‚¨Ö Quay l·∫°i</button>
        <h2 class="text-center" id="hotel-name">ƒêang t·∫£i...</h2>

        <div class="card">
            <div class="card-body" id="hotel-details">
                <p><strong>üìç ƒê·ªãa ch·ªâ:</strong> <span id="hotel-address"></span></p>
                <p><strong>üìû Hotline:</strong> <span id="hotel-hotline"></span></p>
                <p><strong>üìå Khu v·ª±c:</strong> <span id="hotel-area"></span></p>
                <p><strong>üí∞ Gi√°:</strong> <span id="hotel-rate"></span> VNƒê</p>
                <p><strong>üè® Tr·∫°ng th√°i:</strong> <span id="hotel-status"></span></p>
                <p><strong>üìù M√¥ t·∫£:</strong> <span id="hotel-description"></span></p>
                <p><strong>‚≠ê ƒê√°nh gi√°:</strong> <span id="hotel-review"></span></p>
                <a href="#room-list" class="btn btn-primary">Xem ph√≤ng</a>
            </div>
        </div>

        <!-- Danh s√°ch ph√≤ng -->
        <div id="room-list" class="mt-5">
            <h3 class="text-center">Danh s√°ch ph√≤ng</h3>
            <div id="room-container" class="row"></div>
        </div>
    </div>

    <!-- Modal Chi Ti·∫øt Ph√≤ng -->
    <div class="modal fade" id="roomDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="room-title">Chi ti·∫øt ph√≤ng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <img id="room-img" class="img-fluid mb-3" src="" alt="Room Image">
                    <p><strong>üìè Di·ªán t√≠ch:</strong> <span id="room-size"></span> m¬≤</p>
                    <p><strong>üë• S·ª©c ch·ª©a:</strong> <span id="room-capacity"></span> ng∆∞·ªùi</p>
                    <p><strong>üõè Lo·∫°i gi∆∞·ªùng:</strong> <span id="room-bed"></span></p>
                    <p><strong>üõé Ti·ªán nghi:</strong> <span id="room-services"></span></p>
                    <p><strong>üí∞ Gi√°:</strong> <span id="room-price"></span> VNƒê</p>
                    <p><strong>   C√≤n Tr·ªëng:</strong> <span id="room-availability"></span> ph√≤ng</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getHotelIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get("hotel_id");
        }

        async function fetchHotelDetails() {
            const hotelId = getHotelIdFromUrl();
            if (hotelId) {
                console.log(hotelId); 
            } else {
                console.error("Kh√¥ng c√≥ hotelid");
                return;
            }
        
            const apiUrl = `http://127.0.0.1:5000/hotels/${hotelId}`;
        
            try {
                let response = await fetch(apiUrl);
                let hotel = await response.json();
        
                document.getElementById("hotel-name").textContent = hotel.name;
                document.getElementById("hotel-address").textContent = hotel.address || "Kh√¥ng c√≥ th√¥ng tin";
                document.getElementById("hotel-hotline").textContent = hotel.hotline || "Kh√¥ng c√≥ th√¥ng tin";
                document.getElementById("hotel-area").textContent = hotel.area || "Kh√¥ng x√°c ƒë·ªãnh";
                document.getElementById("hotel-rate").textContent = hotel.rate ? hotel.rate + " tri·ªáu" : "Ch∆∞a c√≥";
                document.getElementById("hotel-status").textContent = hotel.status || "Kh√¥ng r√µ";
                document.getElementById("hotel-description").textContent = hotel.description || "Kh√¥ng c√≥ m√¥ t·∫£.";
                document.getElementById("hotel-review").textContent = hotel.review_score ? hotel.review_score + " / 10" : "Ch∆∞a c√≥";
                fetchRoomTypes(hotelId);  
            } catch (error) {
                console.error("L·ªói t·∫£i d·ªØ li·ªáu kh√°ch s·∫°n:", error);
            }
        }

        async function fetchRoomTypes(hotelId) {
            const roomApiUrl = `http://127.0.0.1:5000/hotels/${hotelId}/roomtypes`;

            try {
                let response = await fetch(roomApiUrl);
                let rooms = await response.json();

                displayRooms(rooms);
            } catch (error) {
                console.error("L·ªói t·∫£i th√¥ng tin ph√≤ng:", error);
            }
        }

        function displayRooms(rooms) {
            const roomContainer = document.getElementById("room-container");
            roomContainer.innerHTML = "";

            rooms.forEach(room => {
                let roomCard = document.createElement("div");
                roomCard.classList.add("col-md-4");

                roomCard.innerHTML = `
                    <div class="card room-card shadow-sm">
                        <img src="${room.image || 'default-room.jpg'}" class="room-img" alt="${room.name}">
                        <div class="room-info">
                            <h5>${room.name}</h5>
                            <p><strong>Gi√°:</strong> ${room.price} VNƒê</p>
                            <p><strong>C√≤n tr·ªëng:</strong> ${room.availability} ph√≤ng</p>
                            <button class="btn btn-info" onclick="viewRoomDetails(${room.id})">Xem chi ti·∫øt</button>
                            <button class="btn btn-success" onclick="selectRoom(${room.id})">Ch·ªçn</button>
                        </div>
                    </div>
                `;

                roomContainer.appendChild(roomCard);
            });
        }

        async function viewRoomDetails(roomId) {
            const apiUrl = `http://127.0.0.1:5000/roomtypes/${roomId}`;

            try {
                let response = await fetch(apiUrl);
                let room = await response.json();

                document.getElementById("room-title").textContent = room.name;
                document.getElementById("room-img").src = room.image || "default-room.jpg";
                document.getElementById("room-size").textContent = room.area;
                document.getElementById("room-capacity").textContent = room.capacity;
                document.getElementById("room-bed").textContent = room.bed_type;
                document.getElementById("room-services").textContent = room.services || "Kh√¥ng c√≥ th√¥ng tin";
                document.getElementById("room-price").textContent = room.price;
                document.getElementById("room-availability").textContent = room.availability;

                new bootstrap.Modal(document.getElementById("roomDetailModal")).show();
            } catch (error) {
                console.error("L·ªói l·∫•y th√¥ng tin ph√≤ng:", error);
            }
        }

        async function selectRoom(roomId) {
            try {
                const apiUrl = `http://127.0.0.1:5000/roomtypes/${roomId}`;
                let response = await fetch(apiUrl);
                if (!response.ok) throw new Error("Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu ph√≤ng.");
        
                let room = await response.json();
                console.log(room.availability)
                if (room.availability > 0) {
                    window.location.href = `additionalservices.html?room_type_id=${roomId}`;
                } else {
                    alert("Ph√≤ng n√†y ƒë√£ h·∫øt, kh√¥ng th·ªÉ ch·ªçn.");
                }
            } catch (error) {
                console.error("L·ªói khi ch·ªçn ph√≤ng:", error);
                alert("ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i.");
            }
        }
        

        function goBack() {
            window.history.back();
        }

        fetchHotelDetails();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
